<?xml version="1.0" encoding="utf-8" ?><MAGE><Ability><Name>[Misc] Initialization</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-------------------------------------------------------------------------------
-- Variables &amp; Sanity checks
-------------------------------------------------------------------------------
-- PQInterface is an absolute requirement from now on.
if not IsAddOnLoaded(&amp;quot;PQInterface&amp;quot;) then
	PQR_WriteToChat(&amp;quot;|cffDC143CPQInterface is required to run this profile!|cffffffff&amp;quot;, &amp;quot;Warning&amp;quot;)
	PQR_WriteToChat(&amp;quot;|cffDC143CThe profile has been stopped.|cffffffff&amp;quot;, &amp;quot;Warning&amp;quot;)
	PQR_StopRotation()
end

-- Load LUA data files.
if PQR_RotationStarted == true then
	PQR_RotationStarted = false	

	-- Load LUA files
	if PQR_LoadLua ~= nil then
		if PQR_LoadLua(&amp;quot;PQR_Hysteria_Data.lua&amp;quot;) == false then
			PQR_WriteToChat(&amp;quot;|cffb73737You&amp;apos;re missing PQR_Hysteria_Data.lua - Make sure it&amp;apos;s in your Data folder! The Rotation has been halted.|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_StopRotation()
			return true
		end
		if PQR_LoadLua(&amp;quot;PQR_PQI.lua&amp;quot;) == false then
			PQR_WriteToChat(&amp;quot;|cffb73737You&amp;apos;re missing PQR_PQI.lua - It&amp;apos;s required to run the profile! The Rotation has been halted.|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_StopRotation()
			return true
		end
	end
end

-- Let&amp;apos;s not continue if we&amp;apos;re not in the right spec
if UnitLevel(&amp;quot;player&amp;quot;) &amp;gt;= 10 then
	if not CastTimer then CastTimer = GetTime() end
	if GetSpecialization() == 1 then CurSpec = &amp;quot;Arcane&amp;quot; elseif GetSpecialization() == 2 then CurSpec = &amp;quot;Fire&amp;quot; end
	if GetSpecialization() ~= 3 then
		if GetTime() - CastTimer &amp;gt;= 4 then
			PQR_WriteToChat(&amp;quot;|cff99CCFFYou&amp;apos;re currently specced: |cffb73737&amp;quot;..CurSpec..&amp;quot;|cffffffff!&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_WriteToChat(&amp;quot;|cff99CCFFThe profile has been paused. Please change to Frost!&amp;quot;, &amp;quot;Error&amp;quot;)
			CastTimer = GetTime()
		end
	end
end

-- Unerring Vision of Lei-Shen check.
local itemCheck = itemCheck
local visionTrinket = visionTrinket
if itemCheck(visionTrinket) == 1 then hasVision = true else hasVision = false end

-- Icy Veins can be glyphed!
if IsPlayerSpell(56364) then PQ_IV = 131078
	else PQ_IV = 12472 end

-- Cooldown Timer function
if not SCDtimer then SCDtimer = 0 end
if not SCD then SCD = false end
if SCD then
	PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cooldown Mode: Manual&amp;quot;, nil, &amp;quot;DC143C&amp;quot;)
else
	PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cooldown Mode: Automatic&amp;quot;, nil, &amp;quot;79BAEC&amp;quot;)
end

if not SCDtimer then SCDtimer = 0 end
if PQI_MentallyMage_ToggleCooldownMode_enable
	and not GetCurrentKeyBoardFocus()
	and PQI:IsHotkeys(PQI_MentallyMage_ToggleCooldownMode_key)
	and GetTime() - SCDtimer &amp;gt; 1
then
	SCDtimer = GetTime()
	if SCD then
		SCD = false
		PQR_WriteToChat(&amp;quot;|cff347C2CCooldown Mode: |cff79BAECAutomatic|cffffffff&amp;quot;, &amp;quot;Notice&amp;quot;)
	else
		SCD = true
		PQR_WriteToChat(&amp;quot;|cff347C2CCooldown Mode: |cffDC143CManual|cffffffff&amp;quot;, &amp;quot;Notice&amp;quot;)
	end
end

-- Variables
PQR_ResetMovementTime = 0.3

-- Don&amp;apos;t automatically start if we&amp;apos;re mounted.
if IsMounted() then return true end

-- Don&amp;apos;t automatically start if we&amp;apos;re dead or a ghost.
if UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) then return true end

-- At this point, everything should have loaded perfectly!
if not PQ_FrostLoaded then
	local Hysteria = CreateFrame(&amp;quot;Frame&amp;quot;)
	Hysteria:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)
	Hysteria:SetScript(&amp;quot;OnEvent&amp;quot;, HysteriaFrame_OnEvent)
	Hysteria:Show()
	
	-- Trinket Procs
	Trinket = 0
	
	-- Living Bomb
	LivingBomb = 0
	
	PQ_FrostLoaded = true
	PQR_WriteToChat(&amp;quot;|cff91e782Hysteria Frost Mage data is |cff82cee7Loaded!|cffffffff&amp;quot;)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyMage_Healthstone_enable then return false end
local v=PQI_MentallyMage_Healthstone_value
local Hysteria_UnitInfo = Hysteria_UnitInfo

if GetItemCount(5512,false,true) &amp;gt; 0
	and Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt;= v
	and PQR_SpellAvailable(5512)
	and UnitAffectingCombat(&amp;quot;player&amp;quot;)
	and GetItemCooldown(5512) == 0
then
	UseItemByName(5512)
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Mana Gem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local glyphedGem = false
local v=PQI_MentallyMage_ManaGem_value

if not PQI_MentallyMage_ManaGem_enable then return false end
if IsPlayerSpell(56383) then glyphedGem = true end

-- Regular Mana Gem
if not glyphedGem then
	if GetItemCount(36799,false,true) &amp;gt; 0
		and select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;)) &amp;lt; v
		and UnitAffectingCombat(&amp;quot;player&amp;quot;)
		and GetItemCooldown(36799) == 0
	then UseItemByName(36799) return true end
else
	-- Glyphed Mana Gem
	if GetItemCount(81901,false,true) &amp;gt; 0
		and select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;)) &amp;lt; v
		and UnitAffectingCombat(&amp;quot;player&amp;quot;)
		and GetItemCooldown(81901) == 0
	then UseItemByName(81901) return true end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Pet Management</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyMage_PetManagement_enable then return false end

local PQ_WElm = PQ_WElm

-- Don&amp;apos;t execute if we&amp;apos;re flying.
if IsFlying() then return false end

-- Don&amp;apos;t execute if we&amp;apos;re in the air.
if IsFalling() then return false end

-- Don&amp;apos;t execute if we&amp;apos;ve got a CD.
if not PQR_SpellAvailable(PQ_WElm) then return false end

-- Don&amp;apos;t attempt to spam the ability
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_WElm) then return false end

-- Summon Water Elemental if we don&amp;apos;t have one active.
if not UnitExists(&amp;quot;pet&amp;quot;) then
	CastSpellByName(GetSpellInfo(PQ_WElm),&amp;quot;player&amp;quot;)
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Automatic Buffing</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FA = PQ_FA
local PQ_WElm = PQ_WElm
local PQ_ABril = PQ_ABril
local PQ_DBril = PQ_DBril

if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_FA)
	and UnitBuffID(&amp;quot;player&amp;quot;,PQ_FA) then SpellStopCasting() return false end
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_WElm) then return false end
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_FA) then return false end

-- Buff if we don&amp;apos;t have Frost Armor
if not UnitBuffID(&amp;quot;player&amp;quot;,PQ_FA) then
	CastSpellByName(GetSpellInfo(PQ_FA),&amp;quot;player&amp;quot;)
	return true
end

-- Buff Brilliance if we don&amp;apos;t have a Spellpower buff
if not PQ_AuraInfo(5,&amp;quot;player&amp;quot;) then
	CastSpellByName(GetSpellInfo(PQ_ABril),&amp;quot;player&amp;quot;)
	return true
end

-- Buff Brilliance if we don&amp;apos;t have a Crit buff
if not PQ_AuraInfo(7,&amp;quot;player&amp;quot;) then
	CastSpellByName(GetSpellInfo(PQ_ABril),&amp;quot;player&amp;quot;)
	return true
end

-- Make sure our pet is set to auto-attack!
if not select(2,GetSpellAutocast(31707)) then
	EnableSpellAutocast(GetSpellInfo(31707))
end

if PQI_MentallyMage_RaidBuffing_enable then
	-- Group setting
	if IsInRaid() then group = &amp;quot;raid&amp;quot;
		elseif IsInGroup() then group = &amp;quot;party&amp;quot;
	else return false end
	
	for i=1,GetNumGroupMembers() do
		local member = group..i
		
		-- Spellpower Multiplier
		if not PQ_AuraInfo(5,member) and IsSpellInRange(GetSpellInfo(PQ_ABril),member) == 1 then
			CastSpellByName(GetSpellInfo(PQ_ABril),member)
			return true
		end
		
		-- Crit Multiplier
		if not PQ_AuraInfo(7,member) and IsSpellInRange(GetSpellInfo(PQ_ABril),member) == 1 then
			CastSpellByName(GetSpellInfo(PQ_ABril),member)
			return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Instanced Combat Detection</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyMage_CombatDetection_enable then return false end

if (not UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitExists(&amp;quot;boss1&amp;quot;))
	or not UnitAffectingCombat(&amp;quot;player&amp;quot;)
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Create Mana Gem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local glyphedGem = false
if IsPlayerSpell(56383) then glyphedGem = true end

if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(759) then return false end
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(119316) then return false end

-- Regular Mana Gem
if GetItemCount(36799,false,true) &amp;lt; 2
	and PQR_SpellAvailable(759)
	and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
	and not glyphedGem
then CastSpellByName(GetSpellInfo(759),&amp;quot;player&amp;quot;) return true end

-- Improved Mana Gem
if GetItemCount(81901,false,true) &amp;lt; 5
	and PQR_SpellAvailable(119316)
	and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
	and glyphedGem
then CastSpellByName(GetSpellInfo(119316),&amp;quot;player&amp;quot;) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Pause Rotation</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyMage_PauseRotation_enable then return false end

if PQI:IsHotkeys(PQI_MentallyMage_PauseRotation_key)
	and not GetCurrentKeyBoardFocus() then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Level 30 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Barrier = PQ_Barrier
local PQ_Temporal = PQ_Temporal

if not PQI_MentallyMage_Level30Talent_enable then return false end

if IsPlayerSpell(PQ_Barrier) then
	if PQR_SpellAvailable(PQ_Barrier)
		and PQI:IsHotkeys(PQI_MentallyMage_Level30Talent_key)
		and not GetCurrentKeyBoardFocus() then
			SpellCancelQueuedSpell()
			CastSpellByName(GetSpellInfo(PQ_Barrier),&amp;quot;player&amp;quot;)
			return true
	end
end

if IsPlayerSpell(PQ_Temporal) then
	if PQR_SpellAvailable(PQ_Temporal)
		and PQI:IsHotkeys(PQI_MentallyMage_Level30Talent_key)
		and not GetCurrentKeyBoardFocus() then
			SpellCancelQueuedSpell()
			CastSpellByName(GetSpellInfo(PQ_Temporal),&amp;quot;player&amp;quot;)
			return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Level 45 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FJ = PQ_FJ
local PQ_IW = PQ_IW
local PQ_RoF = PQ_RoF

if not PQI_MentallyMage_Level45Talent_enable then return false end

if IsPlayerSpell(PQ_FJ) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_FJ)
		and PQI:IsHotkeys(PQI_MentallyMage_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_FJ),&amp;quot;target&amp;quot;)
			return true
	end
end

if IsPlayerSpell(PQ_IW) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_IW)
		and PQI:IsHotkeys(PQI_MentallyMage_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_IW),&amp;quot;target&amp;quot;)
			return true
	end
end

if IsPlayerSpell(PQ_RoF) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_RoF)
		and PQI:IsHotkeys(PQI_MentallyMage_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_RoF),nil)
			if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
			return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Level 90 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Evo = PQ_Evo
local PQ_RoP = PQ_RoP
local PQ_Invo = PQ_Invo
local PQ_Ward = PQ_Ward

if not PQI_MentallyMage_Level90Talent_enable then return false end

if IsPlayerSpell(PQ_Invo) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_Evo)
		and PQI:IsHotkeys(PQI_MentallyMage_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_Evo),&amp;quot;player&amp;quot;)
			return true
	end
end

if IsPlayerSpell(PQ_RoP) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_RoP)
		and PQI:IsHotkeys(PQI_MentallyMage_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_RoP),nil)
			if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
			return true
	end
end

if IsPlayerSpell(PQ_Ward) then
	if PQR_SpellAvailable(PQ_Ward)
		and PQI:IsHotkeys(PQI_MentallyMage_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_Ward),&amp;quot;player&amp;quot;)
			return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Herbalism: Lifeblood</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local SpecialUnit = SpecialUnit
local SCD = SCD

-- Disable usage when disabled in PQInterface
if not PQI_MentallyMage_AutoRacials_enable then return false end

-- Let&amp;apos;s only use it in Combat
if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end

-- Stop if we&amp;apos;re saving Cooldowns.
if SCD then return false end

-- Lifeblood Ranks
PQ_Lifeblood = {81708,74497,121279,55428,55480,55500,55501,55502,55503}

for i=1,#PQ_Lifeblood do
	if IsPlayerSpell(PQ_Lifeblood[i])
		and PQR_SpellAvailable(PQ_Lifeblood[i])
	then
		if not PQI_MentallyMage_BossOnlyCooldowns_enable then
			CastSpellByName(GetSpellInfo(PQ_Lifeblood[i]),&amp;quot;player&amp;quot;)
			return true
		else
			if SpecialUnit() then
				CastSpellByName(GetSpellInfo(PQ_Lifeblood[i]),&amp;quot;player&amp;quot;)
				return true
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Auto Potion</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_HasHero = PQ_HasHero
local SpecialUnit = SpecialUnit

-- Disable if disabled in PQInterface
if not PQI_MentallyMage_AutoPotion_enable then return false end

if GetItemCount(76093,false,true) &amp;gt; 0
	and GetItemCooldown(76093) == 0
	and PQ_HasHero()
	and SpecialUnit()
then UseItemByName(76093) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Racials</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IV = PQ_IV
local SCD = SCD
local PQ_HasHero = PQ_HasHero
local SpecialUnit = SpecialUnit
local Hysteria_UnitInfo = Hysteria_UnitInfo

-- Disable when disabled in PQInterface
if not PQI_MentallyMage_AutoRacials_enable then return false end

-- Don&amp;apos;t use outside of Combat
if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end

-- Disable if we&amp;apos;re saving Cooldowns
if SCD then return false end

-- Draenei: Gift of the Naaru
if IsPlayerSpell(59544) and PQR_SpellAvailable(59544) and Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt; 60 then
	CastSpellByName(GetSpellInfo(59544),&amp;quot;player&amp;quot;)
	return true
end

-- Troll: Berserking
if IsPlayerSpell(26297) then
	if UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV) and PQR_SpellAvailable(26297) then
		if not PQI_MentallyMage_BossOnlyCooldowns_enable then
			if UnitExists(&amp;quot;target&amp;quot;) then
				CastSpellByName(GetSpellInfo(26297),&amp;quot;player&amp;quot;) return true
			end
		else
			if SpecialUnit() then
				CastSpellByName(GetSpellInfo(26297),&amp;quot;player&amp;quot;) return true
			end
		end
	end
end

-- Blood Elf: Arcane Torrent
if IsPlayerSpell(28730) then
	if PQR_SpellAvailable(28730) and select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;)) &amp;lt; 92
		and UnitExists(&amp;quot;target&amp;quot;) then
			CastSpellByName(GetSpellInfo(28730),&amp;quot;player&amp;quot;) return true
	end
end

-- Orc: Blood Fury
if IsPlayerSpell(33702) then
	if UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV) and PQR_SpellAvailable(33702) then
		if not PQI_MentallyMage_BossOnlyCooldowns_enable then
			if UnitExists(&amp;quot;target&amp;quot;) then
				CastSpellByName(GetSpellInfo(33702),&amp;quot;player&amp;quot;) return true
			end
		else
			if SpecialUnit() then
				CastSpellByName(GetSpellInfo(33702),&amp;quot;player&amp;quot;) return true
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Mirror Image</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_MI = PQ_MI
local SCD = SCD
local SpecialUnit = SpecialUnit
local PQ_Frostbolt = PQ_Frostbolt
local TargetValidation = TargetValidation

-- Disable if disabled in PQInterface
if not PQI_MentallyMage_AutomaticMirrorImage_enable then return false end

-- Disable if we&amp;apos;re saving cooldowns
if SCD then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_Frostbolt) and PQR_SpellAvailable(PQ_MI) then
	if not PQI_MentallyMage_BossOnlyCooldowns_enable then
		CastSpellByName(GetSpellInfo(PQ_MI),&amp;quot;target&amp;quot;) return true
	else
		if SpecialUnit() then
			CastSpellByName(GetSpellInfo(PQ_MI),&amp;quot;target&amp;quot;) return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Icy Veins</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IV = PQ_IV
local PQ_POM = PQ_POM
local PQ_Frostbolt = PQ_Frostbolt
local FS,_,_,FScount = UnitDebuffID(&amp;quot;target&amp;quot;,PQ_Frostbolt,&amp;quot;PLAYER&amp;quot;)

-- Don&amp;apos;t use outside of combat
if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end

if PQI_MentallyMage_AutomaticFrostMode_enable then
	-- Sync up with Presence of Mind if we have it.
	if IsPlayerSpell(PQ_POM) and not PQR_SpellAvailable(PQ_POM) then
		if select(2,GetSpellCooldown(PQ_POM)) &amp;lt; 15 then return false end
	end
	
	-- Saving cooldowns, disable.
	if SCD then return false end
	
	if IsPlayerSpell(PQ_IV)
		and FS and FScount &amp;gt; 2
		and UnitExists(&amp;quot;target&amp;quot;)
		and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
		and PQR_SpellAvailable(PQ_IV)
		and not PQR_IsMoving(0.3) then
			if PQI_MentallyMage_BossOnlyCooldowns_enable then
				if SpecialUnit() then
					CastSpellByName(GetSpellInfo(PQ_IV),&amp;quot;player&amp;quot;) return true
				end
			else
				CastSpellByName(GetSpellInfo(PQ_IV),&amp;quot;player&amp;quot;) return true
			end
	end
end

if not PQI_MentallyMage_AutomaticFrostMode_enable then
	if not PQI_MentallyMage_IcyVeins_enable then return false end
	if not PQI:IsHotkeys(PQI_MentallyMage_IcyVeins_key) then return false end

	if IsPlayerSpell(PQ_IV)
		and PQR_SpellAvailable(PQ_IV)
		and PQI:IsHotkeys(PQI_MentallyMage_IcyVeins_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_IV),&amp;quot;player&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Alter Time</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_AT = PQ_AT
local PQ_IV = PQ_IV
local PQ_ATB = PQ_ATB
local PQ_POM = PQ_POM

if PQI_MentallyMage_AutomaticFrostMode_enable then
	-- Sync up with Presence of Mind if we have it.
	if IsPlayerSpell(PQ_POM) and not PQR_SpellAvailable(PQ_POM) then
		if select(2,GetSpellCooldown(PQ_POM)) &amp;lt; 15 then return false end
	end

	if IsPlayerSpell(PQ_AT)
		and UnitExists(&amp;quot;target&amp;quot;)
		and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
		and PQR_SpellAvailable(PQ_AT)
		and UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV)
		and UnitAffectingCombat(&amp;quot;player&amp;quot;)
		and not PQR_IsMoving(0.3) then
			if PQI_MentallyMage_BossOnlyCooldowns_enable then
				if SpecialUnit() then
					CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;) return true
				end
			else
				CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;) return true
			end
	end
end

if not PQI_MentallyMage_AutomaticFrostMode_enable then
	if not PQI_MentallyMage_AlterTime_enable then return false end
	if not PQI:IsHotkeys(PQI_MentallyMage_AlterTime_key) then return false end

	if IsPlayerSpell(PQ_AT)
		and PQR_SpellAvailable(PQ_AT)
		and not UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB)
		and PQI:IsHotkeys(PQI_MentallyMage_AlterTime_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Presence of Mind</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IV = PQ_IV
local PQ_POM = PQ_POM

if not PQI_MentallyMage_AutomaticFrostMode_enable then return false end

if not IsPlayerSpell(PQ_POM) then return false end
if not UnitExists(&amp;quot;target&amp;quot;) then return false end
if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end

if UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV) or select(2,GetSpellCooldown(PQ_IV)) &amp;gt; 15 then
	if PQR_SpellAvailable(PQ_POM) then
		CastSpellByName(GetSpellInfo(PQ_POM),&amp;quot;player&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Pet] Freeze</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Freeze = PQ_Freeze

if not PQI_MentallyMage_PetFreezeMouseover_enable then return false end

if UnitExists(&amp;quot;pet&amp;quot;)
	and PQR_SpellAvailable(PQ_Freeze)
	and PQI:IsHotkeys(PQI_MentallyMage_PetFreezeMouseover_key)
	and not GetCurrentKeyBoardFocus() then
		CastSpellByName(GetSpellInfo(PQ_Freeze),nil)
		if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
		return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Flamestrike (Mouseover)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FS = PQ_FS

if not PQI_MentallyMage_FlamestrikeMouseover_enable then return false end

if PQR_SpellAvailable(PQ_FS)
	and PQI:IsHotkeys(PQI_MentallyMage_FlamestrikeMouseover_key)
	and not GetCurrentKeyBoardFocus() then
		CastSpellByName(GetSpellInfo(PQ_FS),nil)
		if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
		return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Frozen Orb</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FO = PQ_FO
local PQ_FoF = PQ_FoF
local SpecialUnit = SpecialUnit

if IsPlayerSpell(PQ_FO)
	and UnitExists(&amp;quot;target&amp;quot;)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
	and PQR_SpellAvailable(PQ_FO)
	and not PQR_IsMoving(0.3) then
		if not PQI_MentallyMage_BossOnlyCooldowns_enable then
			CastSpellByName(GetSpellInfo(PQ_FO),&amp;quot;target&amp;quot;) return true
		else
			if SpecialUnit() then
				CastSpellByName(GetSpellInfo(PQ_FO),&amp;quot;target&amp;quot;) return true
			end
		end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Fire Blast (Movement)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FBlast = PQ_FBlast
local TargetValidation = TargetValidation

if not PQR_IsMoving(0.3) then return false end
if not PQR_SpellAvailable(PQ_FBlast) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_FBlast) then
	CastSpellByName(GetSpellInfo(PQ_FBlast),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ice Lance (Movement)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IL = PQ_IL
local TargetValidation = TargetValidation

if not PQR_IsMoving(0.3) then return false end
if not PQR_SpellAvailable(PQ_IL) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_IL) then
	CastSpellByName(GetSpellInfo(PQ_IL),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Frostfire Bolt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IV = PQ_IV
local SCD = SCD
local PQ_ATB = PQ_ATB
local PQ_FFB = PQ_FFB
local PQ_BrainF = PQ_BrainF
local TargetValidation = TargetValidation
local IVCD = GetSpellCooldown(PQ_IV) + select(2,GetSpellCooldown(PQ_IV)) - GetTime()

-- Don&amp;apos;t cast anything if we don&amp;apos;t have a buff
if not UnitBuffID(&amp;quot;player&amp;quot;,PQ_BrainF) then return false end

-- During automatic mode, only cast if Alter Time is active, Icy Veins on CD or we&amp;apos;re saving CDs
if PQI_MentallyMage_AutomaticFrostMode_enable then
	if SpecialUnit() then
		if UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB) or IVCD &amp;gt; 10 or SCD then
			if TargetValidation(&amp;quot;target&amp;quot;,PQ_FFB) then
				CastSpellByName(GetSpellInfo(PQ_FFB),&amp;quot;target&amp;quot;) return true
			end
		end
	else
		if TargetValidation(&amp;quot;target&amp;quot;,PQ_FFB) then
			CastSpellByName(GetSpellInfo(PQ_FFB),&amp;quot;target&amp;quot;) return true
		end
	end
else
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_FFB) then
		CastSpellByName(GetSpellInfo(PQ_FFB),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ice Lance</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IV = PQ_IV
local SCD = SCD
local PQ_ATB = PQ_ATB
local PQ_IL = PQ_IL
local PQ_FoF = PQ_FoF
local SpecialUnit = SpecialUnit
local TargetValidation = TargetValidation
local IVCD = GetSpellCooldown(PQ_IV) + select(2,GetSpellCooldown(PQ_IV)) - GetTime()

-- Don&amp;apos;t cast anything if we don&amp;apos;t have a buff
if not UnitBuffID(&amp;quot;player&amp;quot;,PQ_FoF) then return false end

-- During automatic mode, only cast if Alter Time is active, Icy Veins on CD or we&amp;apos;re saving CDs
if PQI_MentallyMage_AutomaticFrostMode_enable then
	if SpecialUnit() then
		if UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB) or IVCD &amp;gt; 10 or SCD then
			if TargetValidation(&amp;quot;target&amp;quot;,PQ_IL) then
				CastSpellByName(GetSpellInfo(PQ_IL),&amp;quot;target&amp;quot;) return true
			end
		end
	else
		if TargetValidation(&amp;quot;target&amp;quot;,PQ_IL) then
			CastSpellByName(GetSpellInfo(PQ_IL),&amp;quot;target&amp;quot;) return true
		end
	end
else
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_IL) then
		CastSpellByName(GetSpellInfo(PQ_IL),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Frostbolt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Frostbolt = PQ_Frostbolt
local TargetValidation = TargetValidation

if PQR_IsMoving(0.3) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_Frostbolt) then
	CastSpellByName(GetSpellInfo(PQ_Frostbolt),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_LB = PQ_LB
local PQ_NT = PQ_NT
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

if IsPlayerSpell(PQ_LB) then
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_LB) and not UnitDebuffID(&amp;quot;target&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;) then
		if LivingBomb &amp;lt; 3 then
			CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;target&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_NT) then
	local NT,_,_,_,_,_,NTtimer = UnitDebuffID(&amp;quot;target&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;)

	if UnitExists(&amp;quot;target&amp;quot;)
	and PQR_SpellAvailable(PQ_NT)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;target&amp;quot;, 1) then
		if NT then
			if NTtimer - GetTime() &amp;lt;= 2 then
				CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;target&amp;quot;) return true
			end
		else
			CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;target&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if PQR_IsMoving(0.3) then return false end

	if UnitExists(&amp;quot;target&amp;quot;)
	and PQR_SpellAvailable(PQ_FrostBomb)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;target&amp;quot;, 1) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Focus)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_LB = PQ_LB
local PQ_NT = PQ_NT
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

-- Disable if disabled in PQInterface
if not PQI_MentallyMage_FocusDotting_enable then return false end

if IsPlayerSpell(PQ_LB) then
	if TargetValidation(&amp;quot;focus&amp;quot;,PQ_LB) and not UnitDebuffID(&amp;quot;focus&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;) then
		if LivingBomb &amp;lt; 3 then
			CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;focus&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_NT) then
	local NT,_,_,_,_,_,NTtimer = UnitDebuffID(&amp;quot;focus&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;)

	if UnitExists(&amp;quot;focus&amp;quot;)
	and PQR_SpellAvailable(PQ_NT)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;focus&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 1) then
		if NT then
			if NTtimer - GetTime() &amp;lt;= 2 then
				CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;focus&amp;quot;) return true
			end
		else
			CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;focus&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if PQR_IsMoving(0.3) then return false end

	if UnitExists(&amp;quot;focus&amp;quot;)
	and PQR_SpellAvailable(PQ_FrostBomb)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;focus&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 1) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;focus&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Focus</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Mouseover)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_LB = PQ_LB
local PQ_NT = PQ_NT
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

-- Disable if disabled in PQInterface
if not PQI_MentallyMage_MouseoverDotting_enable then return false end

if IsPlayerSpell(PQ_LB) then
	if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_LB) and not UnitDebuffID(&amp;quot;mouseover&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;) then
		if LivingBomb &amp;lt; 3 then
			CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;mouseover&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_NT) then
	local NT,_,_,_,_,_,NTtimer = UnitDebuffID(&amp;quot;mouseover&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;)

	if UnitExists(&amp;quot;mouseover&amp;quot;)
	and PQR_SpellAvailable(PQ_NT)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;mouseover&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;mouseover&amp;quot;, 1) then
		if NT then
			if NTtimer - GetTime() &amp;lt;= 2 then
				CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;mouseover&amp;quot;) return true
			end
		else
			CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;mouseover&amp;quot;) return true
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if PQR_IsMoving(0.3) then return false end

	if UnitExists(&amp;quot;mouseover&amp;quot;)
	and PQR_SpellAvailable(PQ_FrostBomb)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;) == 1
	and not UnitIsDeadOrGhost(&amp;quot;mouseover&amp;quot;)
	and not PQR_IsOutOfSight(&amp;quot;mouseover&amp;quot;, 1) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;mouseover&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Mouseover</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Boss)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_NT = PQ_NT
local PQ_Frostbolt = PQ_Frostbolt
local TargetValidation = TargetValidation

-- Disable if disabled in PQInterface
if not PQI_MentallyMage_AutoBossDotting_enable then return false end

for i=1,4 do
	local bossUnit = &amp;quot;boss&amp;quot;..i
	
	if TargetValidation(bossUnit,PQ_Frostbolt) then
		-- Bad, bad immunities.
		if UnitBuffID(bossUnit,116994) or UnitBuffID(bossUnit,122540) or UnitBuffID(bossUnit,123250)
			then return false end

		-- Nether Tempest
		if IsPlayerSpell(PQ_NT) then
			local NT,_,_,_,_,_,NTtimer = UnitDebuffID(bossUnit,PQ_NT,&amp;quot;PLAYER&amp;quot;)
			
			if PQR_SpellAvailable(PQ_NT) then
				if NT then
					if NTtimer - GetTime &amp;lt;= 2 then
						CastSpellByName(GetSpellInfo(PQ_NT),bossUnit) return true
					end
				else CastSpellByName(GetSpellInfo(PQ_NT),bossUnit) return true end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Frag Belt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Belt = GetInventoryItemID(&amp;quot;player&amp;quot;, 6)

-- Don&amp;apos;t use it if it&amp;apos;s on cooldown as well!
if GetItemCooldown(Belt) &amp;gt; 0 then return false end

-- Cast Frag Belt on target during Metamorphosis
if GetCurrentKeyBoardFocus() == nil and UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;mouseover&amp;quot;) then
	UseItemByName(Belt)
	if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></MAGE>